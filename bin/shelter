#!/usr/bin/env python
"""Shelter. Log your terminal and sync it with Etherpad (or other repository).

Usage:
  main.py <padID> [--config <configfile>] --dedicated
  main.py <padID> [--config <configfile>] --section [--marker <marker>]

Options:
  -h --help     Show this screen.
  --dedicated   Use dedicated Etherpad to log console
  --section     Use a section in the Etherpad to log console
  --config <configfile>  Load configuration from config file (default: .config).
  --marker <marker>  Marker used as separator. If None, random marker is generated (default: random).
"""

from docopt import docopt
from ConfigParser import SafeConfigParser
from tempfile import NamedTemporaryFile

from shelter.main import doMain

if __name__=='__main__':
    args = docopt(__doc__, version='Shelter v0.1')

    logfile = NamedTemporaryFile(delete=True).name
    print 'Using temp file: ',logfile
    padID = args['<padID>']
    doSection = args['--section']
    marker = args['--marker']

    defaultConfig = {
            'apikey'  : 'no-api-key',
            'baseurl': 'http://localhost:9001/api'
        }
    config = SafeConfigParser(defaultConfig)
    config.add_section('shelter')
    if args['--config']:
        config.read(args['--config'])
    apikey = config.get('shelter', 'apikey')
    baseurl = config.get('shelter', 'baseurl')

    doMain(apikey, padID, marker, baseurl, logfile, doSection)
